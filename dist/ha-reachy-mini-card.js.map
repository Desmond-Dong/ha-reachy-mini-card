{"version":3,"file":"ha-reachy-mini-card.js","sources":["src/ha-reachy-mini-card.js"],"sourcesContent":["// Reachy Mini 3D Card - Direct Daemon Connection\n// Version: 3.1.0\n// https://github.com/Desmond-Dong/ha-reachy-mini-card\n\n/* global OrbitControls */\n\n(function () {\n  'use strict';\n\n  // Ë¢´Âä®ÂÖ≥ËäÇÂêçÁß∞Â∏∏Èáè\n  const PASSIVE_JOINT_NAMES = [\n    'passive_1_x', 'passive_1_y', 'passive_1_z',\n    'passive_2_x', 'passive_2_y', 'passive_2_z',\n    'passive_3_x', 'passive_3_y', 'passive_3_z',\n    'passive_4_x', 'passive_4_y', 'passive_4_z',\n    'passive_5_x', 'passive_5_y', 'passive_5_z',\n    'passive_6_x', 'passive_6_y', 'passive_6_z',\n    'passive_7_x', 'passive_7_y', 'passive_7_z',\n  ];\n\n  // ÈÖçÁΩÆÁºñËæëÂô® - ÂøÖÈ°ªÂú®‰∏ªÂç°‰πãÂâçÂÆö‰πâÂíåÊ≥®ÂÜå\n  class ReachyMini3DCardEditor extends HTMLElement {\n    constructor() {\n      super();\n      this.attachShadow({ mode: 'open' });\n    }\n\n    setConfig(config) {\n      this._config = config;\n      this.render();\n    }\n\n    render() {\n      const config = this._config || {};\n\n      this.shadowRoot.innerHTML = `\n      <style>\n        :host { display: block; }\n        .form-row {\n          display: flex;\n          flex-direction: column;\n          margin-bottom: 12px;\n        }\n        label {\n          font-size: 14px;\n          font-weight: 500;\n          margin-bottom: 4px;\n          color: var(--primary-text-color);\n        }\n        input[type=\"text\"],\n        input[type=\"number\"] {\n          width: 100%;\n          padding: 8px;\n          border: 1px solid var(--primary-color);\n          border-radius: 4px;\n          background: var(--card-background-color);\n          color: var(--primary-text-color);\n          box-sizing: border-box;\n        }\n        input[type=\"text\"]:focus,\n        input[type=\"number\"]:focus {\n          outline: none;\n          border-color: var(--accent-color);\n        }\n        .checkbox-row {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin-bottom: 8px;\n        }\n        .checkbox-row input[type=\"checkbox\"] {\n          width: auto;\n          margin: 0;\n        }\n        .checkbox-row label {\n          margin-bottom: 0;\n          flex: 1;\n        }\n        .hint {\n          font-size: 12px;\n          color: var(--secondary-text-color);\n          margin-top: 4px;\n        }\n        .section-title {\n          font-size: 13px;\n          font-weight: 600;\n          color: var(--primary-text-color);\n          margin-top: 16px;\n          margin-bottom: 8px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n      </style>\n\n      <div class=\"section-title\">Connection</div>\n\n      <div class=\"form-row\">\n        <label for=\"host\">Daemon Host</label>\n        <input\n          id=\"host\"\n          type=\"text\"\n          value=\"${config.daemon_host || 'localhost'}\"\n          placeholder=\"localhost or IP address\"\n        />\n        <div class=\"hint\">Reachy Mini daemon hostname or IP address</div>\n      </div>\n\n      <div class=\"form-row\">\n        <label for=\"port\">Daemon Port</label>\n        <input\n          id=\"port\"\n          type=\"number\"\n          value=\"${config.daemon_port || 8000}\"\n          placeholder=\"8000\"\n        />\n        <div class=\"hint\">WebSocket port (default: 8000)</div>\n      </div>\n\n      <div class=\"section-title\">Display</div>\n\n      <div class=\"form-row\">\n        <label for=\"height\">Card Height (px)</label>\n        <input\n          id=\"height\"\n          type=\"number\"\n          value=\"${config.height || 400}\"\n          placeholder=\"400\"\n        />\n        <div class=\"hint\">Height of the card in pixels</div>\n      </div>\n\n      <div class=\"form-row\">\n        <label for=\"background\">Background Color</label>\n        <input\n          id=\"background\"\n          type=\"text\"\n          value=\"${config.background_color || '#f5f5f5'}\"\n          placeholder=\"#f5f5f5\"\n        />\n        <div class=\"hint\">Background color (hex code)</div>\n      </div>\n\n      <div class=\"form-row\">\n        <label for=\"camera_distance\">Camera Distance</label>\n        <input\n          id=\"camera_distance\"\n          type=\"number\"\n          step=\"0.1\"\n          value=\"${config.camera_distance || 0.5}\"\n          placeholder=\"0.5\"\n        />\n        <div class=\"hint\">Initial camera distance (0.2 - 1.5)</div>\n      </div>\n\n      <div class=\"section-title\">Features</div>\n\n      <div class=\"checkbox-row\">\n        <input type=\"checkbox\" id=\"enable_passive\" ${config.enable_passive_joints !== false ? 'checked' : ''}>\n        <label for=\"enable_passive\">Enable Passive Joints</label>\n      </div>\n      <div class=\"hint\">Show Stewart platform passive joints (requires daemon support)</div>\n\n      <div class=\"checkbox-row\">\n        <input type=\"checkbox\" id=\"enable_pose\" ${config.enable_head_pose !== false ? 'checked' : ''}>\n        <label for=\"enable_pose\">Enable Head Pose</label>\n      </div>\n      <div class=\"hint\">Use 4x4 pose matrix for head positioning</div>\n\n      <div class=\"checkbox-row\">\n        <input type=\"checkbox\" id=\"enable_grid\" ${config.enable_grid !== false ? 'checked' : ''}>\n        <label for=\"enable_grid\">Show Grid</label>\n      </div>\n      <div class=\"hint\">Display ground grid helper</div>\n    `;\n\n      // ÁõëÂê¨ËæìÂÖ•ÂèòÂåñ\n      this.shadowRoot.getElementById('host').addEventListener('change', (e) => {\n        this._config = { ...this._config, daemon_host: e.target.value };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('port').addEventListener('change', (e) => {\n        this._config = { ...this._config, daemon_port: parseInt(e.target.value) };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('height').addEventListener('change', (e) => {\n        this._config = { ...this._config, height: parseInt(e.target.value) };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('background').addEventListener('change', (e) => {\n        this._config = { ...this._config, background_color: e.target.value };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('camera_distance').addEventListener('change', (e) => {\n        this._config = { ...this._config, camera_distance: parseFloat(e.target.value) };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('enable_passive').addEventListener('change', (e) => {\n        this._config = { ...this._config, enable_passive_joints: e.target.checked };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('enable_pose').addEventListener('change', (e) => {\n        this._config = { ...this._config, enable_head_pose: e.target.checked };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('enable_grid').addEventListener('change', (e) => {\n        this._config = { ...this._config, enable_grid: e.target.checked };\n        this.dispatchConfig();\n      });\n    }\n\n    dispatchConfig() {\n      const event = new CustomEvent('config-changed', {\n        detail: { config: this._config },\n        bubbles: true,\n        composed: true\n      });\n      this.dispatchEvent(event);\n    }\n  }\n\n  // Ê≥®ÂÜåÁºñËæëÂô®\n  customElements.define('ha-reachy-mini-card-editor', ReachyMini3DCardEditor);\n\n  // ‰∏ªÂç°ÁâáÁªÑ‰ª∂\n  class ReachyMini3DCard extends HTMLElement {\n    constructor() {\n      super();\n      this.attachShadow({ mode: 'open' });\n      this._frameCount = 0;\n      this._lastDataVersion = -1;\n      this._robotState = {\n        headJoints: null,\n        headPose: null,\n        passiveJoints: null,\n        antennas: [0, 0],\n        dataVersion: 0\n      };\n      this._reconnectAttempts = 0;\n      this._maxReconnectAttempts = 10;\n      this._reconnectDelay = 3000;\n      this._reconnectTimeout = null;\n    }\n\n    static getConfigElement() {\n      return document.createElement('ha-reachy-mini-card-editor');\n    }\n\n    static getStubConfig() {\n      return {\n        daemon_host: 'localhost',\n        daemon_port: 8000,\n        height: 400,\n        enable_passive_joints: true,\n        enable_head_pose: true,\n        background_color: '#f5f5f5',\n        enable_grid: true,\n        camera_distance: 0.5\n      };\n    }\n\n    setConfig(config) {\n      this._config = {\n        daemon_host: 'localhost',\n        daemon_port: 8000,\n        height: 400,\n        enable_passive_joints: true,\n        enable_head_pose: true,\n        background_color: '#f5f5f5',\n        enable_grid: true,\n        camera_distance: 0.5,\n        ...config\n      };\n    }\n\n    getCardSize() {\n      return this._config.height ? this._config.height / 50 : 8;\n    }\n\n    getGridOptions() {\n      // Grid options for sections view (12 columns grid)\n      const height = this._config.height || 400;\n      const rows = Math.ceil(height / 50);\n      return {\n        rows: rows,\n        columns: 6,\n        min_rows: 4,\n        max_rows: 20,\n      };\n    }\n\n    set hass(hass) {\n      // Store Home Assistant instance (required by custom card API)\n      this._hass = hass;\n      // This card doesn't use HA entities directly, but set hass is required\n    }\n\n    async connectedCallback() {\n      this.render();\n      await this.init();\n    }\n\n    render() {\n      this.shadowRoot.innerHTML = `\n      <style>\n        :host { display: block; }\n        ha-card {\n          overflow: hidden;\n          border-radius: var(--ha-card-border-radius, 12px);\n          box-shadow: var(--ha-card-box-shadow, none);\n        }\n        #container {\n          position: relative;\n          width: 100%;\n          height: ${this._config.height}px;\n        }\n        #status {\n          position: absolute;\n          top: 10px;\n          left: 10px;\n          padding: 6px 12px;\n          border-radius: 20px;\n          font-size: 12px;\n          font-weight: 500;\n          color: white;\n          z-index: 10;\n          transition: all 0.3s ease;\n        }\n        .connected { background: #4caf50; }\n        .connecting { background: #ff9800; }\n        .error { background: #f44336; }\n        .loading {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n        }\n        #fps-counter {\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          padding: 4px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          font-weight: 500;\n          color: white;\n          background: rgba(0, 0, 0, 0.6);\n          z-index: 10;\n        }\n      </style>\n      <ha-card>\n        <div id=\"container\">\n          <div id=\"status\" class=\"connecting\">Connecting...</div>\n          <div id=\"fps-counter\">0 FPS</div>\n          <div id=\"loading\" class=\"loading\">\n            <ha-circular-progress indeterminate></ha-circular-progress>\n          </div>\n        </div>\n      </ha-card>\n    `;\n    }\n\n    async init() {\n      try {\n        await this.loadThreeJS();\n        this._setupScene();\n        await this.loadRobot();\n        this.startPolling();\n      } catch (err) {\n        console.error('Init error:', err);\n        this.showError(err.message);\n      }\n    }\n\n    async loadThreeJS() {\n      const basePath = this.getBasePath();\n      \n      // Check if already loaded\n      if (typeof THREE !== 'undefined' && THREE) {\n        console.log('‚úÖ Three.js already loaded');\n        return;\n      }\n\n      console.log('üì¶ Loading Three.js from lib/three.module.js...');\n      \n      try {\n        // Use dynamic import to load Three.js as a module\n        const threeModule = await import(`${basePath}lib/three.module.js`);\n        \n        // Create global THREE object with all exports\n        window.THREE = threeModule;\n        \n        console.log('‚úÖ Three.js loaded');\n        \n        // Load OrbitControls using dynamic import\n        const orbitControlsModule = await import(`${basePath}lib/OrbitControls.js`);\n        \n        // Add OrbitControls to global for linter\n        window.OrbitControls = orbitControlsModule.OrbitControls || orbitControlsModule.default;\n        \n        console.log('‚úÖ OrbitControls loaded');\n      } catch (error) {\n        console.error('‚ùå Failed to load Three.js:', error);\n        throw new Error('Failed to load Three.js: ' + error.message);\n      }\n    }\n\n    startPolling() {\n      const { daemon_host, daemon_port } = this._config;\n      const apiUrl = `http://${daemon_host}:${daemon_port}/api/state/full?with_control_mode=true&with_head_joints=true&with_body_yaw=true&with_antenna_positions=true&with_passive_joints=true`;\n      \n      console.log('üîÑ Starting polling:', apiUrl);\n      \n      this._pollingInterval = setInterval(async () => {\n        try {\n          const response = await fetch(apiUrl);\n          if (response.ok) {\n            const data = await response.json();\n            this._processRobotData(data);\n            this.updateStatus('connected', 'Connected');\n          } else {\n            console.error('‚ùå API error:', response.status);\n            this.updateStatus('error', `Error: ${response.status}`);\n          }\n        } catch (err) {\n          console.error('‚ùå Polling error:', err);\n          this.updateStatus('error', 'Connection Failed');\n        }\n      }, 50); // Poll every 50ms (20Hz) like reference project\n    }\n\n    _processRobotData(data) {\n      // head_joints: Array of 7 values [yaw_body, stewart_1, ..., stewart_6]\n      if (data.head_joints && Array.isArray(data.head_joints) && data.head_joints.length >= 7) {\n        this._robotState.headJoints = data.head_joints;\n      }\n      \n      // body_yaw: Single value (same as head_joints[0])\n      if (data.body_yaw !== undefined) {\n        if (!this._robotState.headJoints) {\n          this._robotState.headJoints = [];\n        }\n        this._robotState.headJoints[0] = data.body_yaw;\n      }\n      \n      // head_pose: Object with x, y, z, roll, pitch, yaw\n      if (data.head_pose) {\n        this._robotState.headPose = data.head_pose;\n      }\n      \n      // antennas_position: Array of 2 values [left, right]\n      if (data.antennas_position && Array.isArray(data.antennas_position) && data.antennas_position.length >= 2) {\n        this._robotState.antennas = data.antennas_position;\n      }\n      \n      // passive_joints: Array of 21 values or null\n      if (data.passive_joints && Array.isArray(data.passive_joints) && data.passive_joints.length >= 21) {\n        this._robotState.passiveJoints = data.passive_joints;\n      }\n      \n      this._robotState.dataVersion++;\n      this._updateRobot();\n    }\n\n    _updateRobot() {\n      if (!this._robot) return;\n\n      // Apply head joints\n      if (this._robotState.headJoints) {\n        const joints = this._robotState.headJoints;\n        if (this._robot.joints['yaw_body']) {\n          this._robot.setJointValue('yaw_body', joints[0]);\n        }\n        ['stewart_1', 'stewart_2', 'stewart_3', 'stewart_4', 'stewart_5', 'stewart_6'].forEach((name, i) => {\n          if (this._robot.joints[name]) {\n            this._robot.setJointValue(name, joints[i + 1]);\n          }\n        });\n      }\n\n      // Apply passive joints\n      if (this._config.enable_passive_joints !== false && this._robotState.passiveJoints) {\n        const passiveJoints = this._robotState.passiveJoints;\n        for (let i = 0; i < 21; i++) {\n          const jointName = PASSIVE_JOINT_NAMES[i];\n          if (this._robot.joints[jointName]) {\n            this._robot.setJointValue(jointName, passiveJoints[i]);\n          }\n        }\n      }\n\n      // Apply antennas\n      if (this._robotState.antennas) {\n        const antennas = this._robotState.antennas;\n        if (this._robot.joints['left_antenna']) {\n          this._robot.setJointValue('left_antenna', -antennas[1]);\n        }\n        if (this._robot.joints['right_antenna']) {\n          this._robot.setJointValue('right_antenna', -antennas[0]);\n        }\n      }\n    }\n\n    async loadRobot() {\n      const basePath = this.getBasePath();\n      \n      // Âä®ÊÄÅÂä†ËΩΩ URDFLoader Áõ∏ÂÖ≥Ê®°Âùó\n      await import(`${basePath}lib/URDFClasses.js`);\n      await import(`${basePath}lib/URDFDragControls.js`);\n      \n      const URDFLoaderModule = await import(`${basePath}lib/urdf-loader.js`);\n      const URDFLoader = URDFLoaderModule.default;\n      \n      const loader = new URDFLoader();\n      loader.workingPath = `${basePath}assets/`;\n      \n      this._robot = await loader.load(`${basePath}assets/reachy-mini.urdf`);\n      this._scene.add(this._robot);\n\n      // Initialize all joints to zero\n      this._initializeJoints();\n\n      // Hide loading\n      const loading = this.shadowRoot.querySelector('#loading');\n      if (loading) loading.style.display = 'none';\n\n      // Start animation loop\n      this._startAnimationLoop();\n    }\n\n    _initializeJoints() {\n      if (!this._robot || !this._robot.joints) return;\n\n      // Initialize yaw_body\n      if (this._robot.joints['yaw_body']) {\n        this._robot.setJointValue('yaw_body', 0);\n      }\n\n      // Initialize stewart joints\n      ['stewart_1', 'stewart_2', 'stewart_3', 'stewart_4', 'stewart_5', 'stewart_6'].forEach(jointName => {\n        if (this._robot.joints[jointName]) {\n          this._robot.setJointValue(jointName, 0);\n        }\n      });\n\n      // Initialize passive joints\n      PASSIVE_JOINT_NAMES.forEach(jointName => {\n        if (this._robot.joints[jointName]) {\n          this._robot.setJointValue(jointName, 0);\n        }\n      });\n\n      // Initialize antennas\n      ['left_antenna', 'right_antenna'].forEach(jointName => {\n        if (this._robot.joints[jointName]) {\n          this._robot.setJointValue(jointName, 0);\n        }\n      });\n    }\n\n    _setupScene() {\n      const container = this.shadowRoot.querySelector('#container');\n      const canvas = document.createElement('canvas');\n      canvas.style.width = '100%';\n      canvas.style.height = '100%';\n      container.appendChild(canvas);\n      \n      // Scene\n      this._scene = new THREE.Scene();\n      this._scene.background = new THREE.Color(this._config.background_color || '#f5f5f5');\n\n      // Camera\n      this._camera = new THREE.PerspectiveCamera(\n        50,\n        container.clientWidth / this._config.height,\n        0.01,\n        1000\n      );\n      this._camera.position.set(0.3, 0.3, this._config.camera_distance || 0.5);\n\n      // Renderer\n      this._renderer = new THREE.WebGLRenderer({ canvas, antialias: true });\n      this._renderer.setSize(container.clientWidth, this._config.height);\n      this._renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n\n      // Controls\n      this._controls = new OrbitControls(this._camera, canvas);\n      this._controls.enableDamping = true;\n      this._controls.dampingFactor = 0.05;\n      this._controls.minDistance = 0.2;\n      this._controls.maxDistance = 1.5;\n      this._controls.target.set(0, 0.15, 0);\n\n      // Lights\n      this._scene.add(new THREE.AmbientLight(0xffffff, 0.6));\n      \n      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\n      directionalLight.position.set(1, 1, 1);\n      this._scene.add(directionalLight);\n      \n      const backLight = new THREE.DirectionalLight(0xffffff, 0.3);\n      backLight.position.set(-1, -1, -1);\n      this._scene.add(backLight);\n\n      // Grid\n      if (this._config.enable_grid !== false) {\n        this._scene.add(new THREE.GridHelper(0.4, 20, 0x888888, 0xcccccc));\n      }\n\n      // FPS counter\n      this._fpsCounter = {\n        frameCount: 0,\n        lastTime: performance.now(),\n        fps: 0\n      };\n    }\n\n    _startAnimationLoop() {\n      // Animation loop\n      const animate = () => {\n        this._animationId = requestAnimationFrame(animate);\n        \n        // Update robot state\n        this._updateRobot();\n        \n        // FPS calculation\n        this._fpsCounter.frameCount++;\n        const currentTime = performance.now();\n        if (currentTime - this._fpsCounter.lastTime >= 1000) {\n          this._fpsCounter.fps = this._fpsCounter.frameCount;\n          this._fpsCounter.frameCount = 0;\n          this._fpsCounter.lastTime = currentTime;\n          \n          const fpsEl = this.shadowRoot.querySelector('#fps-counter');\n          if (fpsEl) {\n            fpsEl.textContent = `${this._fpsCounter.fps} FPS`;\n          }\n        }\n        \n        this._controls.update();\n        this._renderer.render(this._scene, this._camera);\n      };\n      animate();\n    }\n\n    updateStatus(status, message) {\n      const statusEl = this.shadowRoot.querySelector('#status');\n      if (statusEl) {\n        statusEl.className = status;\n        statusEl.textContent = message;\n      }\n    }\n\n    showError(message) {\n      const container = this.shadowRoot.querySelector('#container');\n      if (container) {\n        container.innerHTML = `\n          <div style=\"padding: 20px; color: #f44336;\">Error: ${message}</div>\n        `;\n      }\n    }\n\n    getBasePath() {\n      return '/hacsfiles/ha-reachy-mini-card/';\n    }\n\ndisconnectedCallback() {\n      if (this._animationId) {\n        cancelAnimationFrame(this._animationId);\n        this._animationId = null;\n      }\n      if (this._pollingInterval) {\n        clearInterval(this._pollingInterval);\n        this._pollingInterval = null;\n      }\n      if (this._renderer) {\n        this._renderer.dispose();\n        this._renderer = null;\n      }\n      if (this._scene) {\n        this._scene.clear();\n        this._scene = null;\n      }\n    }\n  }\n\n  // Ê≥®ÂÜå‰∏ªÂç°Áâá\n  customElements.define('ha-reachy-mini-card', ReachyMini3DCard);\n\n  // Ê≥®ÂÜåÂà∞ window.customCards ‰ª•‰æøÂú®Âç°ÁâáÈÄâÊã©Âô®‰∏≠ÊòæÁ§∫\n  window.customCards = window.customCards || [];\n  window.customCards.push({\n    type: 'ha-reachy-mini-card',\n    name: 'Reachy Mini 3D Card',\n    description: '3D visualization of Reachy Mini robot',\n    preview: true,\n    documentationURL: 'https://github.com/Desmond-Dong/ha-reachy-mini-card',\n  });\n\n})();"],"names":["PASSIVE_JOINT_NAMES","ReachyMini3DCardEditor","HTMLElement","constructor","super","this","attachShadow","mode","setConfig","config","_config","render","shadowRoot","innerHTML","daemon_host","daemon_port","height","background_color","camera_distance","enable_passive_joints","enable_head_pose","enable_grid","getElementById","addEventListener","e","target","value","dispatchConfig","parseInt","parseFloat","checked","event","CustomEvent","detail","bubbles","composed","dispatchEvent","customElements","define","ReachyMini3DCard","_frameCount","_lastDataVersion","_robotState","headJoints","headPose","passiveJoints","antennas","dataVersion","_reconnectAttempts","_maxReconnectAttempts","_reconnectDelay","_reconnectTimeout","getConfigElement","document","createElement","getStubConfig","getCardSize","getGridOptions","rows","Math","ceil","columns","min_rows","max_rows","hass","_hass","connectedCallback","init","loadThreeJS","_setupScene","loadRobot","startPolling","err","console","error","showError","message","basePath","getBasePath","THREE","log","threeModule","import","window","orbitControlsModule","OrbitControls","default","Error","apiUrl","_pollingInterval","setInterval","async","response","fetch","ok","data","json","_processRobotData","updateStatus","status","head_joints","Array","isArray","length","undefined","body_yaw","head_pose","antennas_position","passive_joints","_updateRobot","_robot","joints","setJointValue","forEach","name","i","jointName","loader","URDFLoader","workingPath","load","_scene","add","_initializeJoints","loading","querySelector","style","display","_startAnimationLoop","container","canvas","width","appendChild","Scene","background","Color","_camera","PerspectiveCamera","clientWidth","position","set","_renderer","WebGLRenderer","antialias","setSize","setPixelRatio","min","devicePixelRatio","_controls","enableDamping","dampingFactor","minDistance","maxDistance","AmbientLight","directionalLight","DirectionalLight","backLight","GridHelper","_fpsCounter","frameCount","lastTime","performance","now","fps","animate","_animationId","requestAnimationFrame","currentTime","fpsEl","textContent","update","statusEl","className","disconnectedCallback","cancelAnimationFrame","clearInterval","dispose","clear","customCards","push","type","description","preview","documentationURL"],"mappings":"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"}