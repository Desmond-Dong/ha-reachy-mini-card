{"version":3,"file":"ha-reachy-mini-card.js","sources":["src/reachy-mini-3d-card.js"],"sourcesContent":["// Reachy Mini 3D Card - Direct Daemon Connection\n// Version: 2.2.0\n// https://github.com/Desmond-Dong/ha-reachy-mini-card\n\n(function () {\n  'use strict';\n\n  // Ë¢´Âä®ÂÖ≥ËäÇÂêçÁß∞Â∏∏Èáè\n  const PASSIVE_JOINT_NAMES = [\n    'passive_1_x', 'passive_1_y', 'passive_1_z',\n    'passive_2_x', 'passive_2_y', 'passive_2_z',\n    'passive_3_x', 'passive_3_y', 'passive_3_z',\n    'passive_4_x', 'passive_4_y', 'passive_4_z',\n    'passive_5_x', 'passive_5_y', 'passive_5_z',\n    'passive_6_x', 'passive_6_y', 'passive_6_z',\n    'passive_7_x', 'passive_7_y', 'passive_7_z',\n  ];\n\n  // ÈÖçÁΩÆÁºñËæëÂô® - ÂøÖÈ°ªÂú®‰∏ªÂç°‰πãÂâçÂÆö‰πâÂíåÊ≥®ÂÜå\n  class ReachyMini3DCardEditor extends HTMLElement {\n    constructor() {\n      super();\n      this.attachShadow({ mode: 'open' });\n    }\n\n    setConfig(config) {\n      this._config = config;\n      this.render();\n    }\n\n    render() {\n      const config = this._config || {};\n\n      this.shadowRoot.innerHTML = `\n      <style>\n        :host { display: block; }\n        .form-row {\n          display: flex;\n          flex-direction: column;\n          margin-bottom: 12px;\n        }\n        label {\n          font-size: 14px;\n          font-weight: 500;\n          margin-bottom: 4px;\n          color: var(--primary-text-color);\n        }\n        input[type=\"text\"],\n        input[type=\"number\"] {\n          width: 100%;\n          padding: 8px;\n          border: 1px solid var(--primary-color);\n          border-radius: 4px;\n          background: var(--card-background-color);\n          color: var(--primary-text-color);\n          box-sizing: border-box;\n        }\n        input[type=\"text\"]:focus,\n        input[type=\"number\"]:focus {\n          outline: none;\n          border-color: var(--accent-color);\n        }\n        .checkbox-row {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin-bottom: 8px;\n        }\n        .checkbox-row input[type=\"checkbox\"] {\n          width: auto;\n          margin: 0;\n        }\n        .checkbox-row label {\n          margin-bottom: 0;\n          flex: 1;\n        }\n        .hint {\n          font-size: 12px;\n          color: var(--secondary-text-color);\n          margin-top: 4px;\n        }\n        .section-title {\n          font-size: 13px;\n          font-weight: 600;\n          color: var(--primary-text-color);\n          margin-top: 16px;\n          margin-bottom: 8px;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n      </style>\n\n      <div class=\"section-title\">Connection</div>\n\n      <div class=\"form-row\">\n        <label for=\"host\">Daemon Host</label>\n        <input\n          id=\"host\"\n          type=\"text\"\n          value=\"${config.daemon_host || 'localhost'}\"\n          placeholder=\"localhost or IP address\"\n        />\n        <div class=\"hint\">Reachy Mini daemon hostname or IP address</div>\n      </div>\n\n      <div class=\"form-row\">\n        <label for=\"port\">Daemon Port</label>\n        <input\n          id=\"port\"\n          type=\"number\"\n          value=\"${config.daemon_port || 8000}\"\n          placeholder=\"8000\"\n        />\n        <div class=\"hint\">WebSocket port (default: 8000)</div>\n      </div>\n\n      <div class=\"section-title\">Display</div>\n\n      <div class=\"form-row\">\n        <label for=\"height\">Card Height (px)</label>\n        <input\n          id=\"height\"\n          type=\"number\"\n          value=\"${config.height || 400}\"\n          placeholder=\"400\"\n        />\n        <div class=\"hint\">Height of the card in pixels</div>\n      </div>\n\n      <div class=\"form-row\">\n        <label for=\"background\">Background Color</label>\n        <input\n          id=\"background\"\n          type=\"text\"\n          value=\"${config.background_color || '#f5f5f5'}\"\n          placeholder=\"#f5f5f5\"\n        />\n        <div class=\"hint\">Background color (hex code)</div>\n      </div>\n\n      <div class=\"form-row\">\n        <label for=\"camera_distance\">Camera Distance</label>\n        <input\n          id=\"camera_distance\"\n          type=\"number\"\n          step=\"0.1\"\n          value=\"${config.camera_distance || 0.5}\"\n          placeholder=\"0.5\"\n        />\n        <div class=\"hint\">Initial camera distance (0.2 - 1.5)</div>\n      </div>\n\n      <div class=\"section-title\">Features</div>\n\n      <div class=\"checkbox-row\">\n        <input type=\"checkbox\" id=\"enable_passive\" ${config.enable_passive_joints !== false ? 'checked' : ''}>\n        <label for=\"enable_passive\">Enable Passive Joints</label>\n      </div>\n      <div class=\"hint\">Show Stewart platform passive joints (requires daemon support)</div>\n\n      <div class=\"checkbox-row\">\n        <input type=\"checkbox\" id=\"enable_pose\" ${config.enable_head_pose !== false ? 'checked' : ''}>\n        <label for=\"enable_pose\">Enable Head Pose</label>\n      </div>\n      <div class=\"hint\">Use 4x4 pose matrix for head positioning</div>\n\n      <div class=\"checkbox-row\">\n        <input type=\"checkbox\" id=\"enable_grid\" ${config.enable_grid !== false ? 'checked' : ''}>\n        <label for=\"enable_grid\">Show Grid</label>\n      </div>\n      <div class=\"hint\">Display ground grid helper</div>\n    `;\n\n      // ÁõëÂê¨ËæìÂÖ•ÂèòÂåñ\n      this.shadowRoot.getElementById('host').addEventListener('change', (e) => {\n        this._config = { ...this._config, daemon_host: e.target.value };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('port').addEventListener('change', (e) => {\n        this._config = { ...this._config, daemon_port: parseInt(e.target.value) };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('height').addEventListener('change', (e) => {\n        this._config = { ...this._config, height: parseInt(e.target.value) };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('background').addEventListener('change', (e) => {\n        this._config = { ...this._config, background_color: e.target.value };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('camera_distance').addEventListener('change', (e) => {\n        this._config = { ...this._config, camera_distance: parseFloat(e.target.value) };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('enable_passive').addEventListener('change', (e) => {\n        this._config = { ...this._config, enable_passive_joints: e.target.checked };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('enable_pose').addEventListener('change', (e) => {\n        this._config = { ...this._config, enable_head_pose: e.target.checked };\n        this.dispatchConfig();\n      });\n\n      this.shadowRoot.getElementById('enable_grid').addEventListener('change', (e) => {\n        this._config = { ...this._config, enable_grid: e.target.checked };\n        this.dispatchConfig();\n      });\n    }\n\n    dispatchConfig() {\n      const event = new CustomEvent('config-changed', {\n        detail: { config: this._config },\n        bubbles: true,\n        composed: true\n      });\n      this.dispatchEvent(event);\n    }\n  }\n\n  // Ê≥®ÂÜåÁºñËæëÂô®\n  customElements.define('reachy-mini-3d-card-editor', ReachyMini3DCardEditor);\n\n  // ‰∏ªÂç°ÁâáÁªÑ‰ª∂\n  class ReachyMini3DCard extends HTMLElement {\n    constructor() {\n      super();\n      this.attachShadow({ mode: 'open' });\n      this._frameCount = 0;\n      this._lastDataVersion = -1;\n      this._robotState = {\n        headJoints: null,\n        headPose: null,\n        passiveJoints: null,\n        antennas: [0, 0],\n        dataVersion: 0\n      };\n      this._reconnectAttempts = 0;\n      this._maxReconnectAttempts = 10;\n      this._reconnectDelay = 3000;\n      this._reconnectTimeout = null;\n    }\n\n    static get getConfigElement() {\n      return document.createElement('reachy-mini-3d-card-editor');\n    }\n\n    static getStubConfig() {\n      return {\n        daemon_host: 'localhost',\n        daemon_port: 8000,\n        height: 400,\n        enable_passive_joints: true,\n        enable_head_pose: true,\n        background_color: '#f5f5f5',\n        enable_grid: true,\n        camera_distance: 0.5\n      };\n    }\n\n    setConfig(config) {\n      this._config = {\n        daemon_host: 'localhost',\n        daemon_port: 8000,\n        height: 400,\n        enable_passive_joints: true,\n        enable_head_pose: true,\n        background_color: '#f5f5f5',\n        enable_grid: true,\n        camera_distance: 0.5,\n        ...config\n      };\n    }\n\n    getCardSize() {\n      return this._config.height ? this._config.height / 50 : 8;\n    }\n\n    async connectedCallback() {\n      this.render();\n      await this.init();\n    }\n\n    render() {\n      this.shadowRoot.innerHTML = `\n      <style>\n        :host { display: block; }\n        ha-card {\n          overflow: hidden;\n          border-radius: var(--ha-card-border-radius, 12px);\n          box-shadow: var(--ha-card-box-shadow, none);\n        }\n        #container {\n          position: relative;\n          width: 100%;\n          height: ${this._config.height}px;\n        }\n        #status {\n          position: absolute;\n          top: 10px;\n          left: 10px;\n          padding: 6px 12px;\n          border-radius: 20px;\n          font-size: 12px;\n          font-weight: 500;\n          color: white;\n          z-index: 10;\n          transition: all 0.3s ease;\n        }\n        .connected { background: #4caf50; }\n        .connecting { background: #ff9800; }\n        .error { background: #f44336; }\n        .loading {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate(-50%, -50%);\n        }\n        #fps-counter {\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          padding: 4px 8px;\n          border-radius: 12px;\n          font-size: 11px;\n          font-weight: 500;\n          color: white;\n          background: rgba(0, 0, 0, 0.6);\n          z-index: 10;\n        }\n      </style>\n      <ha-card>\n        <div id=\"container\">\n          <div id=\"status\" class=\"connecting\">Connecting...</div>\n          <div id=\"fps-counter\">0 FPS</div>\n          <div id=\"loading\" class=\"loading\">\n            <ha-circular-progress indeterminate></ha-circular-progress>\n          </div>\n        </div>\n      </ha-card>\n    `;\n    }\n\n    async init() {\n      try {\n        await this.loadThreeJS();\n        await this.connectWebSocket();\n        await this.loadRobot();\n      } catch (err) {\n        console.error('Init error:', err);\n        this.showError(err.message);\n      }\n    }\n\n    async loadThreeJS() {\n      return new Promise((resolve, reject) => {\n        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂä†ËΩΩ\n        if (window.THREE && window.OrbitControls) {\n          resolve();\n          return;\n        }\n\n        // Âä†ËΩΩ Three.js\n        const threeScript = document.createElement('script');\n        threeScript.src = 'https://cdn.jsdelivr.net/npm/three@0.181.0/build/three.min.js';\n        threeScript.onload = () => {\n          console.log('‚úÖ Three.js loaded');\n          \n          // Âä†ËΩΩ OrbitControls\n          const orbitScript = document.createElement('script');\n          orbitScript.src = 'https://cdn.jsdelivr.net/npm/three@0.181.0/examples/js/controls/OrbitControls.js';\n          orbitScript.onload = () => {\n            console.log('‚úÖ OrbitControls loaded');\n            resolve();\n          };\n          orbitScript.onerror = () => {\n            reject(new Error('Failed to load OrbitControls'));\n          };\n          document.head.appendChild(orbitScript);\n        };\n        threeScript.onerror = () => {\n          reject(new Error('Failed to load Three.js'));\n        };\n        document.head.appendChild(threeScript);\n      });\n    }\n\n    async connectWebSocket() {\n      const { daemon_host, daemon_port } = this._config;\n      let wsUrl = `ws://${daemon_host}:${daemon_port}/api/state/ws/full?frequency=20`;\n      wsUrl += '&with_head_joints=true';\n      wsUrl += '&with_antenna_positions=true';\n      if (this._config.enable_passive_joints !== false) {\n        wsUrl += '&with_passive_joints=true';\n      }\n      if (this._config.enable_head_pose !== false) {\n        wsUrl += '&with_head_pose=true';\n        wsUrl += '&use_pose_matrix=true';\n      }\n\n      console.log('üîå Connecting to WebSocket:', wsUrl);\n      this._ws = new WebSocket(wsUrl);\n\n      this._ws.onopen = () => {\n        console.log('‚úÖ WebSocket connected');\n        this._reconnectAttempts = 0;\n        this.updateStatus('connected', 'Connected');\n      };\n\n      this._ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          this._processRobotData(data);\n        } catch (err) {\n          console.error('‚ùå Parse error:', err);\n        }\n      };\n\n      this._ws.onerror = (error) => {\n        console.error('‚ùå WebSocket error:', error);\n        this.updateStatus('error', 'Error');\n      };\n\n      this._ws.onclose = () => {\n        console.log('üîå WebSocket closed');\n        this.updateStatus('error', 'Disconnected');\n        \n        if (this._reconnectAttempts < this._maxReconnectAttempts) {\n          this._reconnectAttempts++;\n          const delay = Math.min(\n            this._reconnectDelay * Math.pow(1.5, this._reconnectAttempts - 1),\n            30000\n          );\n          \n          console.log(`üîÑ Reconnecting in ${delay}ms (attempt ${this._reconnectAttempts}/${this._maxReconnectAttempts})`);\n          \n          this._reconnectTimeout = setTimeout(() => {\n            this.connectWebSocket();\n          }, delay);\n        } else {\n          console.error('‚ùå Max reconnection attempts reached');\n          this.updateStatus('error', 'Connection Failed');\n        }\n      };\n    }\n\n    _processRobotData(data) {\n      if (data.head_joints && Array.isArray(data.head_joints) && data.head_joints.length === 7) {\n        this._robotState.headJoints = data.head_joints;\n      }\n      \n      if (data.head_pose) {\n        const headPoseArray = Array.isArray(data.head_pose) \n          ? data.head_pose \n          : data.head_pose.m;\n        if (headPoseArray && headPoseArray.length === 16) {\n          this._robotState.headPose = headPoseArray;\n        }\n      }\n      \n      if (data.antennas_position && Array.isArray(data.antennas_position) && data.antennas_position.length >= 2) {\n        this._robotState.antennas = data.antennas_position;\n      }\n      \n      if (data.passive_joints && Array.isArray(data.passive_joints) && data.passive_joints.length >= 21) {\n        this._robotState.passiveJoints = data.passive_joints;\n      }\n      \n      this._robotState.dataVersion++;\n      this._updateRobot();\n    }\n\n    _updateRobot() {\n      if (!this._robot) return;\n      \n      this._frameCount++;\n      if (this._frameCount % 3 !== 0) {\n        return; // Throttle to ~20Hz\n      }\n      \n      if (this._robotState.dataVersion === this._lastDataVersion) {\n        return; // No new data\n      }\n      this._lastDataVersion = this._robotState.dataVersion;\n\n      // Apply head joints\n      if (this._robotState.headJoints) {\n        const joints = this._robotState.headJoints;\n        if (this._robot.joints['yaw_body']) {\n          this._robot.setJointValue('yaw_body', joints[0]);\n        }\n        ['stewart_1', 'stewart_2', 'stewart_3', 'stewart_4', 'stewart_5', 'stewart_6'].forEach((name, i) => {\n          if (this._robot.joints[name]) {\n            this._robot.setJointValue(name, joints[i + 1]);\n          }\n        });\n      }\n\n      // Apply passive joints\n      if (this._config.enable_passive_joints !== false && this._robotState.passiveJoints) {\n        const passiveJoints = this._robotState.passiveJoints;\n        for (let i = 0; i < 21; i++) {\n          const jointName = PASSIVE_JOINT_NAMES[i];\n          if (this._robot.joints[jointName]) {\n            this._robot.setJointValue(jointName, passiveJoints[i]);\n          }\n        }\n      }\n\n      // Apply antennas\n      if (this._robotState.antennas) {\n        const antennas = this._robotState.antennas;\n        if (this._robot.joints['left_antenna']) {\n          this._robot.setJointValue('left_antenna', -antennas[1]);\n        }\n        if (this._robot.joints['right_antenna']) {\n          this._robot.setJointValue('right_antenna', -antennas[0]);\n        }\n      }\n    }\n\n    async loadRobot() {\n      const basePath = this.getBasePath();\n      \n      // Âä®ÊÄÅÂä†ËΩΩ URDFLoader\n      const script = document.createElement('script');\n      script.src = `${basePath}lib/URDFClasses.js`;\n      document.head.appendChild(script);\n      \n      await new Promise(resolve => script.onload = resolve);\n      \n      const script2 = document.createElement('script');\n      script2.src = `${basePath}lib/URDFDragControls.js`;\n      document.head.appendChild(script2);\n      \n      await new Promise(resolve => script2.onload = resolve);\n      \n      const script3 = document.createElement('script');\n      script3.src = `${basePath}lib/urdf-loader.js`;\n      document.head.appendChild(script3);\n      \n      await new Promise(resolve => script3.onload = resolve);\n      \n      const loader = new window.URDFLoader();\n      loader.workingPath = `${basePath}assets/`;\n      \n      this._robot = await loader.load(`${basePath}assets/reachy-mini.urdf`);\n      this._scene.add(this._robot);\n\n      // Initialize all joints to zero\n      this._initializeJoints();\n\n      // Hide loading\n      const loading = this.shadowRoot.querySelector('#loading');\n      if (loading) loading.style.display = 'none';\n\n      // Start animation loop\n      this._startAnimation();\n    }\n\n    _initializeJoints() {\n      if (!this._robot || !this._robot.joints) return;\n\n      // Initialize yaw_body\n      if (this._robot.joints['yaw_body']) {\n        this._robot.setJointValue('yaw_body', 0);\n      }\n\n      // Initialize stewart joints\n      ['stewart_1', 'stewart_2', 'stewart_3', 'stewart_4', 'stewart_5', 'stewart_6'].forEach(jointName => {\n        if (this._robot.joints[jointName]) {\n          this._robot.setJointValue(jointName, 0);\n        }\n      });\n\n      // Initialize passive joints\n      PASSIVE_JOINT_NAMES.forEach(jointName => {\n        if (this._robot.joints[jointName]) {\n          this._robot.setJointValue(jointName, 0);\n        }\n      });\n\n      // Initialize antennas\n      ['left_antenna', 'right_antenna'].forEach(jointName => {\n        if (this._robot.joints[jointName]) {\n          this._robot.setJointValue(jointName, 0);\n        }\n      });\n    }\n\n    _startAnimation() {\n      const container = this.shadowRoot.querySelector('#container');\n      const canvas = document.createElement('canvas');\n      container.appendChild(canvas);\n\n      const THREE = window.THREE;\n      \n      // Scene\n      this._scene = new THREE.Scene();\n      this._scene.background = new THREE.Color(this._config.background_color || '#f5f5f5');\n\n      // Camera\n      this._camera = new THREE.PerspectiveCamera(\n        50,\n        container.clientWidth / this._config.height,\n        0.01,\n        1000\n      );\n      this._camera.position.set(0.3, 0.3, this._config.camera_distance || 0.5);\n\n      // Renderer\n      this._renderer = new THREE.WebGLRenderer({ canvas, antialias: true });\n      this._renderer.setSize(container.clientWidth, this._config.height);\n      this._renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n\n      // Controls\n      this._controls = new window.OrbitControls(this._camera, canvas);\n      this._controls.enableDamping = true;\n      this._controls.dampingFactor = 0.05;\n      this._controls.minDistance = 0.2;\n      this._controls.maxDistance = 1.5;\n\n      // Lights\n      this._scene.add(new THREE.AmbientLight(0xffffff, 0.6));\n      \n      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);\n      directionalLight.position.set(1, 1, 1);\n      this._scene.add(directionalLight);\n      \n      const backLight = new THREE.DirectionalLight(0xffffff, 0.3);\n      backLight.position.set(-1, -1, -1);\n      this._scene.add(backLight);\n\n      // Grid\n      if (this._config.enable_grid !== false) {\n        this._scene.add(new THREE.GridHelper(0.4, 20, 0x888888, 0xcccccc));\n      }\n\n      // FPS counter\n      this._fpsCounter = {\n        frameCount: 0,\n        lastTime: performance.now(),\n        fps: 0\n      };\n\n      // Animation loop\n      const animate = () => {\n        requestAnimationFrame(animate);\n        \n        // FPS calculation\n        this._fpsCounter.frameCount++;\n        const currentTime = performance.now();\n        if (currentTime - this._fpsCounter.lastTime >= 1000) {\n          this._fpsCounter.fps = this._fpsCounter.frameCount;\n          this._fpsCounter.frameCount = 0;\n          this._fpsCounter.lastTime = currentTime;\n          \n          const fpsEl = this.shadowRoot.querySelector('#fps-counter');\n          if (fpsEl) {\n            fpsEl.textContent = `${this._fpsCounter.fps} FPS`;\n          }\n        }\n        \n        this._controls.update();\n        this._renderer.render(this._scene, this._camera);\n      };\n      animate();\n    }\n\n    updateStatus(status, message) {\n      const statusEl = this.shadowRoot.querySelector('#status');\n      if (statusEl) {\n        statusEl.className = status;\n        statusEl.textContent = message;\n      }\n    }\n\n    showError(message) {\n      const container = this.shadowRoot.querySelector('#container');\n      if (container) {\n        container.innerHTML = `\n          <div style=\"padding: 20px; color: #f44336;\">Error: ${message}</div>\n        `;\n      }\n    }\n\n    getBasePath() {\n      const scripts = document.getElementsByTagName('script');\n      const lastScript = scripts[scripts.length - 1];\n      const src = lastScript?.src || '';\n      if (src) {\n        return src.substring(0, src.lastIndexOf('/') + 1);\n      }\n      return '/hacsfiles/ha-reachy-mini-card/';\n    }\n\n    disconnectedCallback() {\n      if (this._ws) {\n        this._ws.close();\n        this._ws = null;\n      }\n      if (this._reconnectTimeout) {\n        clearTimeout(this._reconnectTimeout);\n        this._reconnectTimeout = null;\n      }\n      if (this._renderer) {\n        this._renderer.dispose();\n        this._renderer = null;\n      }\n      if (this._scene) {\n        this._scene.clear();\n        this._scene = null;\n      }\n    }\n  }\n\n  // Ê≥®ÂÜå‰∏ªÂç°Áâá\n  customElements.define('reachy-mini-3d-card', ReachyMini3DCard);\n\n})();"],"names":["PASSIVE_JOINT_NAMES","ReachyMini3DCardEditor","HTMLElement","constructor","super","this","attachShadow","mode","setConfig","config","_config","render","shadowRoot","innerHTML","daemon_host","daemon_port","height","background_color","camera_distance","enable_passive_joints","enable_head_pose","enable_grid","getElementById","addEventListener","e","target","value","dispatchConfig","parseInt","parseFloat","checked","event","CustomEvent","detail","bubbles","composed","dispatchEvent","customElements","define","ReachyMini3DCard","_frameCount","_lastDataVersion","_robotState","headJoints","headPose","passiveJoints","antennas","dataVersion","_reconnectAttempts","_maxReconnectAttempts","_reconnectDelay","_reconnectTimeout","getConfigElement","document","createElement","getStubConfig","getCardSize","connectedCallback","init","loadThreeJS","connectWebSocket","loadRobot","err","console","error","showError","message","Promise","resolve","reject","window","THREE","OrbitControls","threeScript","src","onload","log","orbitScript","onerror","Error","head","appendChild","wsUrl","_ws","WebSocket","onopen","updateStatus","onmessage","data","JSON","parse","_processRobotData","onclose","delay","Math","min","pow","setTimeout","head_joints","Array","isArray","length","head_pose","headPoseArray","m","antennas_position","passive_joints","_updateRobot","_robot","joints","setJointValue","forEach","name","i","jointName","basePath","getBasePath","script","script2","script3","loader","URDFLoader","workingPath","load","_scene","add","_initializeJoints","loading","querySelector","style","display","_startAnimation","container","canvas","Scene","background","Color","_camera","PerspectiveCamera","clientWidth","position","set","_renderer","WebGLRenderer","antialias","setSize","setPixelRatio","devicePixelRatio","_controls","enableDamping","dampingFactor","minDistance","maxDistance","AmbientLight","directionalLight","DirectionalLight","backLight","GridHelper","_fpsCounter","frameCount","lastTime","performance","now","fps","animate","requestAnimationFrame","currentTime","fpsEl","textContent","update","status","statusEl","className","scripts","getElementsByTagName","lastScript","substring","lastIndexOf","disconnectedCallback","close","clearTimeout","dispose","clear"],"mappings":"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"}